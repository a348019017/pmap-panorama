[{"D:\\项目\\全景图\\photo\\src\\main.js":"1","D:\\项目\\全景图\\photo\\src\\directives\\drag.js":"2","D:\\项目\\全景图\\photo\\src\\App2T.vue":"3","D:\\项目\\全景图\\photo\\src\\utils\\panorama.js":"4","D:\\项目\\全景图\\photo\\src\\components\\toolbar\\toolbar2.vue":"5","D:\\项目\\全景图\\photo\\src\\components\\toolbar\\data.js":"6","D:\\项目\\全景图\\photo\\src\\assets\\qindex.js":"7","D:\\项目\\全景图\\photo\\src\\utils\\drawutils.js":"8"},{"size":1099,"mtime":1698126398531,"results":"9","hashOfConfig":"10"},{"size":1377,"mtime":1690360969545,"results":"11","hashOfConfig":"10"},{"size":1127,"mtime":1698126376084,"results":"12","hashOfConfig":"10"},{"size":12434,"mtime":1694403041834,"results":"13","hashOfConfig":"10"},{"size":8665,"mtime":1694080004152,"results":"14","hashOfConfig":"10"},{"size":5638,"mtime":1697679370573,"results":"15","hashOfConfig":"10"},{"size":224651,"mtime":1694063327832,"results":"16","hashOfConfig":"10"},{"size":9126,"mtime":1698136025230,"results":"17","hashOfConfig":"10"},{"filePath":"18","messages":"19","suppressedMessages":"20","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"j3vibj",{"filePath":"21","messages":"22","suppressedMessages":"23","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"24","messages":"25","suppressedMessages":"26","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"27","messages":"28","suppressedMessages":"29","errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"30","usedDeprecatedRules":"31"},{"filePath":"32","messages":"33","suppressedMessages":"34","errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"35"},{"filePath":"36","messages":"37","suppressedMessages":"38","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"39","messages":"40","suppressedMessages":"41","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"42","messages":"43","suppressedMessages":"44","errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"45"},"D:\\项目\\全景图\\photo\\src\\main.js",[],[],"D:\\项目\\全景图\\photo\\src\\directives\\drag.js",[],[],"D:\\项目\\全景图\\photo\\src\\App2T.vue",[],[],"D:\\项目\\全景图\\photo\\src\\utils\\panorama.js",["46","47","48","49","50","51","52","53","54","55","56","57","58","59"],[],"/*\r\n * @Author: xiezhipeng\r\n * @Date: 2023-8-07 10:25:40\r\n * @LastEditors: xiezhipeng\r\n * @LastEditTime: 2023-8-07 10:25:41\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nimport { EquirectangularTilesAdapter } from \"photo-sphere-viewer/dist/adapters/equirectangular-tiles\";\r\nimport { Viewer } from \"photo-sphere-viewer\";\r\nimport { MarkersPlugin } from \"photo-sphere-viewer/dist/plugins/markers\";\r\nimport { GalleryPlugin } from \"photo-sphere-viewer/dist/plugins/gallery\";\r\nimport { VirtualTourPlugin } from \"photo-sphere-viewer/dist/plugins/virtual-tour\";\r\nimport \"photo-sphere-viewer/dist/photo-sphere-viewer.css\";\r\nimport \"photo-sphere-viewer/dist/plugins/markers.css\";\r\nimport \"photo-sphere-viewer/dist/plugins/gallery.css\";\r\nimport \"photo-sphere-viewer/dist/plugins/virtual-tour.css\";\r\nimport * as THREE from \"three\";\r\nimport axios from \"axios\";\r\nimport icon1 from \"@/asset/3dland/service.png\"\r\nimport icon2 from \"@/asset/3dland/hospitalmark.png\"\r\nimport icon3 from \"@/asset/3dland/business.png\"\r\n\r\n\r\nconst tiandituQueryParam={\r\n  baseUrl: \"https://api.tianditu.gov.cn/v2/search\",\r\n  level: 12,\r\n  mapBound: \"114.09583369165028,35.62628683569018,114.48687830834871,35.87343329946653\",//六盘水:\"104.82799834945087,26.545609772366603,104.91963361683992,26.61815347028798\",//鹤壁:\"114.09583369165028,35.62628683569018,114.48687830834871,35.87343329946653\"\r\n  queryType: 1,\r\n  start: 0,\r\n  count: 100,\r\n  type: \"query\",\r\n  queryRadius: 1000,\r\n  tk: \"1ab633275c9b7f231b5ccb4b073d2fd0\"\r\n};\r\n\r\n\r\n/**\r\n * 全景类\r\n */\r\nexport class PanoramaViewer {\r\n  /***\r\n   * 构造全景图插件\r\n   * @param {String} div\r\n   * @param {Object} option\r\n   */\r\n  constructor(div, option) {\r\n    let cfg = {\r\n      adapter: [EquirectangularTilesAdapter,{\r\n        baseBlur: false,\r\n    }],\r\n      container: document.getElementById(div),\r\n      caption: \"全景图\",\r\n      navbar: [\"autorotate\", \"zoom\", \"caption\", \"fullscreen\", \"gallery\"],\r\n      plugins: [\r\n        [MarkersPlugin, {}],\r\n        [\r\n          GalleryPlugin,\r\n          {\r\n            visibleOnLoad: true,\r\n          },\r\n        ],\r\n        // [\r\n        //   VirtualTourPlugin,\r\n        //   {\r\n        //     positionMode: VirtualTourPlugin.MODE_GPS,\r\n        //     renderMode: VirtualTourPlugin.MODE_3D,\r\n        //   },\r\n        // ],\r\n      ],\r\n    };\r\n\r\n    this.PSV = new Viewer(cfg);\r\n\r\n    //传入数据所在根目录\r\n    this.baseUrl2 = option.baseUrl ? option.baseUrl : \"\";\r\n\r\n    this.iconconfig={\r\n      学校:\"3dland/service.png\",\r\n      医院:\"3dland/service.png\",\r\n      超市:\"3dland/service.png\",\r\n   },\r\n    //默认加载第一个\r\n    // if(imagescfg&&imagescfg.length>0)\r\n    // {\r\n    //    this.curphoto=this.curphotos.images[0];\r\n    //    cfg.panorama=imagescfg[0].panorama;\r\n    // }\r\n    // this.PSV = new Viewer(cfg);\r\n\r\n    //panorama-loaded\r\n    this.PSV.on(\"panorama-loaded\", () => {\r\n      \r\n      this.changepano(this.PSV.config.panorama.name);\r\n      \r\n    });\r\n\r\n    this.resultList=[];\r\n    this.resultList2=[];\r\n    this.resultList3=[];\r\n\r\n  }\r\n  loadMarker(option){\r\n\r\n  }\r\n  startPointMarker(){\r\n      \r\n  }\r\n  /**\r\n   * 加载数据,传入配置文件，配置文件记录相关信息\r\n   * @param {*} url\r\n   */\r\n  load(url) {\r\n    //默认加载第一组\r\n  }\r\n  /**\r\n   * 加载全部数据\r\n   * @param {Object} metadata\r\n   */\r\n  loadDatas(metadata) {\r\n    let that = this;\r\n    let imagescfg = this.curphotos.images.map((c) => {\r\n      return that.image2config(c, that.curphotos.name);\r\n    });\r\n  }\r\n  /**\r\n   * 加载单组数据\r\n   * @param {Object} metadata\r\n   */\r\n  loadData(metadata) {\r\n    let that = this;\r\n    let imagescfg = metadata.images.map((c) => {\r\n      return that.image2config(c, metadata.name);\r\n    });\r\n\r\n    //添加link信息,遍历全部id\r\n    let ids = imagescfg.map((i) => i.id);\r\n\r\n    imagescfg.forEach((j) => {\r\n      //排除自己\r\n      let newids = ids\r\n        .filter((k) => {\r\n          return k != j.id;\r\n        })\r\n        .map((f) => {\r\n          return {\r\n            nodeId: f,\r\n          };\r\n        });\r\n      j.links = newids;\r\n    });\r\n\r\n    \r\n    //获取到\r\n    const galleryPlugin = this.PSV.getPlugin(GalleryPlugin);\r\n    galleryPlugin.setItems(imagescfg);\r\n\r\n     //const virtualTourPlugin = this.PSV.getPlugin(VirtualTourPlugin);\r\n     //virtualTourPlugin.setNodes(imagescfg);\r\n\r\n    this.PSV.setPanorama(imagescfg[0].panorama,imagescfg[0].options);\r\n    this.curphotos = metadata;\r\n  }\r\n  //切换全景图时,需要切换标注\r\n  changepano(item) {\r\n    this.curphoto = this.curphotos.images.find((i) => i.imagename == item);\r\n    //this.loadPOI();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * 清除全部标记\r\n   */\r\n  clearMarkers(){\r\n    const markersPlugin = this.PSV.getPlugin(MarkersPlugin);\r\n    markersPlugin.clearMarkers();\r\n  }\r\n\r\n\r\n  \r\n  image2config(item, dkname) {\r\n    let isusetile = false;\r\n    item ? (isusetile = item.usetile) : undefined;\r\n\r\n    let sphereCorrection={pan:0,tilt:0,roll:0};\r\n    \r\n    if(item.panoData&&item.panoData.poseHeading)\r\n    {\r\n      sphereCorrection.pan=item.panoData.poseHeading/180*Math.PI;\r\n    }\r\n    \r\n    if(item.panoData&&item.panoData.posePitch){\r\n      sphereCorrection.tilt=-item.panoData.posePitch/180.0*Math.PI;\r\n    }\r\n    // if(item.panoData&&item.panoData.poseRoll){\r\n    //   sphereCorrection.roll=item.panoData.roll/180*Math.PI;\r\n    // }\r\n\r\n    return {\r\n      id: item.imagename,\r\n      name: item.imagename,\r\n      //baseBlur:false,\r\n      thumbnail: `${this.baseUrl2}${dkname}/${item.imagename}/${item.imagename}_low.JPG`,\r\n      panorama: {\r\n        name: item.imagename,\r\n        width: 8192,\r\n        cols: 8,\r\n        rows: 4,\r\n        baseUrl: `${this.baseUrl2}${dkname}/${item.imagename}/${item.imagename}_low.JPG`,\r\n        tileUrl: (col, row) => {\r\n          return `${this.baseUrl2}${dkname}/${item.imagename}/row-${\r\n            row + 1\r\n          }-column-${col + 1}.jpg`;\r\n        },\r\n        //basePanoData: {poseHeading:0,posePitch:0,poseRoll:0}\r\n      },\r\n      options:{\r\n        sphereCorrection:sphereCorrection,\r\n        zoom:20,\r\n      },\r\n      position: item.lonlat,\r\n      // option:{\r\n      //   width: 8192,\r\n      //   cols: 8,\r\n      //   rows: 4,\r\n      //   baseUrl: `${this.baseUrl2}${item.imagename}/${item.imagename}_low.JPG`,\r\n      //   tileUrl: (col, row) => {\r\n      //     return `${this.baseUrl2}${item.imagename}/row-${row+1}-column-${col+1}.jpg`;\r\n      //   }\r\n      // },\r\n    };\r\n  }\r\n\r\n\r\n  //加载poi的标记点到地图上\r\n  loadPOI(){\r\n      const markersPlugin = this.PSV.getPlugin(MarkersPlugin);\r\n      markersPlugin.clearMarkers();\r\n      //加载内置定义的markers，否则可能加载失败\r\n      if (this.curphoto) {\r\n        // if (this.curphoto.markers) {\r\n        //   this.curphoto.markers.forEach(p => {\r\n        //     markersPlugin.addMarker(p);\r\n        //   })\r\n        // }\r\n        //查询此全景图附近的POI，然后转换成MarkList然后添加进去，先只计算水平方向的offsetdebgre，放在中间，看是否准确。\r\n         this.onQueryNearby({ lon: this.curphoto.lonlat[0], lat:this.curphoto.lonlat[1] }, 3000, \"超市\", this.resultList3);\r\n         this.onQueryNearby({ lon: this.curphoto.lonlat[0], lat:this.curphoto.lonlat[1] }, 3000, \"医院\", this.resultList2);\r\n         this.onQueryNearby({ lon: this.curphoto.lonlat[0], lat:this.curphoto.lonlat[1] }, 3000, \"学校\", this.resultList);\r\n      }\r\n  }\r\n\r\n\r\n  async onQueryNearby(center, radius, keyWord, resultList) {\r\n    let querystr = `${center.lon}, ${center.lat}`;\r\n    let url = `${tiandituQueryParam.baseUrl}?postStr={\"keyWord\":\"${keyWord}\",\"level\":${tiandituQueryParam.level},\"mapBound\":\"${tiandituQueryParam.mapBound}\",\"queryRadius\":${radius},\"queryType\":\"3\",\"start\":${tiandituQueryParam.start},\"pointLonlat\":\"${querystr}\",\"count\":${tiandituQueryParam.count}}&type=${tiandituQueryParam.type}&tk=${tiandituQueryParam.tk}`;\r\n    let that = this;\r\n    await axios\r\n      .get(url, { withCredentials: false })\r\n      .then(({ data }) => {\r\n        if (data.pois && data.pois.length > 0) {\r\n          data.pois.map((item) => {\r\n            let point = item.lonlat.split(\",\");\r\n            item.geom = `POINT(${point[0]} ${point[1]})`;\r\n            //同时计算原始方位角度\r\n            //that.resultList.push(item)\r\n            resultList.push({\r\n              名称: item.name,\r\n              地址: item.address,\r\n              联系电话: item.phone,\r\n              geom: item.geom,\r\n              lonlat:[point[0],point[1]],\r\n              azimuth:that.azimuth(that.curphoto.lonlat,[point[0],point[1]]),\r\n              //atan:-that.distanceToTangle(that.photos[0].lonlat,[point[0],point[1]],that.photos[0].height),\r\n              distance:that.distance(that.curphoto.lonlat,[point[0],point[1]]),\r\n              poitype:keyWord\r\n            });\r\n          });\r\n          //console.log(resultList);\r\n          that.tomarkers({},resultList);\r\n        } else {\r\n           \r\n        }\r\n      })\r\n      .catch((err) => {});\r\n  }\r\n\r\n  tomarkers(option,resultList){\r\n      \r\n    let defaultoffsetlng=option.defaultoffsetlng?option.defaultoffsetlng:0;\r\n    let that=this;\r\n    //查询经纬度一定范围内的poi点，保存然后,计算水平角度\r\n    if(resultList)\r\n    {\r\n      const markersPlugin = this.PSV.getPlugin(MarkersPlugin);\r\n      resultList.forEach(r=>{\r\n        let marker={\r\n          id:r.名称,\r\n          longitude: (r.azimuth)/180.0*3.1415926,\r\n          latitude: -Math.atan(that.curphoto.height/r.distance),\r\n          image: that.iconconfig[r.poitype] ,\r\n          width: 32,\r\n          anchor: 'bottom center',\r\n          height: 81,\r\n          tooltip: r.名称,\r\n          olongitude:(r.azimuth-180.0)/180*3.14,\r\n          olatitude: r.atan,\r\n          distance:r.distance\r\n        };\r\n        markersPlugin.addMarker(marker);\r\n      })\r\n    }\r\n  }\r\n\r\n\r\n  //添加水平控制的UI\r\n  //添加垂直控制的UI\r\n  \r\n  azimuth(lonlat1, lonlat2) {\r\n    var lon1 = THREE.MathUtils.degToRad(lonlat1[0])\r\n    var lat1 = THREE.MathUtils.degToRad(lonlat1[1])\r\n    var lon2 = THREE.MathUtils.degToRad(lonlat2[0])\r\n    var lat2 = THREE.MathUtils.degToRad(lonlat2[1])\r\n\r\n    if (lon1 == lon2) {\r\n      if (lat2 >= lat1) {\r\n        return 0\r\n      } else {\r\n        return 180\r\n      }\r\n    }\r\n    if (lat1 == lat2) {\r\n      if (lon2 > lon1) {\r\n        return 90\r\n      } else if (lon2 < lon1) {\r\n        return 270\r\n      }\r\n    }\r\n\r\n    var a = THREE.MathUtils.radToDeg(Math.atan((lon2 - lon1) * Math.cos(lat2) / (lat2 - lat1)))\r\n    if (lat2 > lat1) {\r\n      if (lon2 > lon1) {\r\n        return a\r\n      } else {\r\n        return a + 360\r\n      }\r\n    } else {\r\n      return a + 180\r\n    }\r\n  }\r\n  \r\n  // //计算两个经纬度之间的空间距离，tang据此进行计算，然后手动自行进行偏移。\r\n  // distanceToTangle(lonlat1, lonlat2,height){\r\n  //   debugger\r\n  //    let point1=  new Cesium.Cartesian3.fromDegrees(lonlat1[0], lonlat1[1]);\r\n  //    let point2=  new Cesium.Cartesian3.fromDegrees(Number.parseFloat(lonlat2[0]),Number.parseFloat(lonlat2[1]));\r\n  //    let distance= Cesium.Cartesian3.distance(point1,point2);\r\n  //    //弧度制\r\n  //    let result= Math.atan(height/distance);\r\n  //    return result;\r\n  // },\r\n  // distance(lonlat1, lonlat2) {\r\n  //   let point1 = new Cesium.Cartesian3.fromDegrees(lonlat1[0], lonlat1[1]);\r\n  //   let point2 = new Cesium.Cartesian3.fromDegrees(Number.parseFloat(lonlat2[0]), Number.parseFloat(lonlat2[1]));\r\n  //   let distance = Cesium.Cartesian3.distance(point1, point2);\r\n  //   return distance;\r\n  // }\r\n\r\n\r\n  distance( lonlat1, lonlat2){\r\n    let lat1=lonlat1[1];\r\n    let lng1=lonlat1[0];\r\n    let lat2=lonlat2[1];\r\n    let lng2=lonlat2[0];\r\n\r\n    var radLat1 = lat1*Math.PI / 180.0;\r\n    var radLat2 = lat2*Math.PI / 180.0;\r\n    var a = radLat1 - radLat2;\r\n    var  b = lng1*Math.PI / 180.0 - lng2*Math.PI / 180.0;\r\n    var s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2) +\r\n    Math.cos(radLat1)*Math.cos(radLat2)*Math.pow(Math.sin(b/2),2)));\r\n    s = s *6378.137 ;// EARTH_RADIUS;\r\n    s = Math.round(s * 10000) / 10;\r\n    return s;\r\n}\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\n/**\r\n * 绘制多边形操作\r\n */\r\nexport class DrawPolygon{\r\n  constructor(viwer, option){\r\n\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport class DrawPoint{\r\n\r\n}\r\n\r\n\r\n\r\n",[],"D:\\项目\\全景图\\photo\\src\\components\\toolbar\\toolbar2.vue",["60","61","62","63","64","65","66"],[],"\r\n<style lang=\"scss\" scoped>\r\n.el-dropdown-link {\r\n  cursor: pointer;\r\n  color: #00dad8;\r\n}\r\n\r\n.el-icon-arrow-down {\r\n  font-size: 12px;\r\n}\r\n\r\n.themsVertical {\r\n  .menuBoxContainer {\r\n    // position: absolute;\r\n    // top: 80px;\r\n    // right: 10px;\r\n    z-index: 9;\r\n\r\n    .eeIconfont {\r\n      font-size: 48px;\r\n    }\r\n  }\r\n\r\n  .menuBoxContent {\r\n    height: calc(100vh - 190px);\r\n    overflow: auto;\r\n  }\r\n\r\n  .menuListCol {\r\n    background: rgba(13, 71, 161, 0.7);\r\n    margin: 5px;\r\n    padding: 5px;\r\n    text-align: center;\r\n  }\r\n\r\n  .menuListCol .toolTitle {\r\n    font-size: 20px;\r\n  }\r\n\r\n  .menuBoxMore {\r\n    background: rgba(13, 71, 161, 0.7);\r\n    color: #fff;\r\n    padding: 5px;\r\n  }\r\n\r\n  .menuBoxMoreBox {\r\n    text-align: center;\r\n    color: #00dad8;\r\n    padding: 0;\r\n    margin: 0;\r\n  }\r\n\r\n  .menuBoxMore .toolTitle {\r\n    font-size: 20px;\r\n  }\r\n\r\n  .menuBoxMore:hover {\r\n    color: #fff !important;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .menuBoxList .fgx {\r\n    color: #fff;\r\n    padding: 0px;\r\n    cursor: default;\r\n  }\r\n\r\n  .menuBoxList .sceneSelect {\r\n    margin: 0px;\r\n  }\r\n\r\n  .menuBoxList span:hover {\r\n    color: #fff;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .menuBoxList .checked {\r\n    color: #fff;\r\n  }\r\n\r\n  .menuBoxContent::-webkit-scrollbar {\r\n    /*滚动条整体样式*/\r\n    width: 1px;\r\n    /*高宽分别对应横竖滚动条的尺寸*/\r\n    height: 1px;\r\n  }\r\n\r\n  .menuBoxContent::-webkit-scrollbar-thumb {\r\n    /*滚动条里面小方块*/\r\n    border-radius: 1px;\r\n    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);\r\n    background: rgba(13, 71, 161, 0.1);\r\n  }\r\n\r\n  .menuBoxContent::-webkit-scrollbar-track {\r\n    /*滚动条里面轨道*/\r\n    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);\r\n    border-radius: 1px;\r\n    background: rgba(13, 71, 161, 0.1);\r\n  }\r\n}\r\n\r\n// 水平\r\n.themsHorizontal {\r\n  .menuBoxContainer {\r\n    // position: absolute;\r\n    // top: 10px;\r\n    // right: 16%;\r\n    z-index: 9;\r\n\r\n    .eeIconfont {\r\n      font-size: 24px;\r\n    }\r\n  }\r\n\r\n  .menuBoxMore {\r\n    display: none;\r\n    background: rgba(13, 71, 161, 0.7);\r\n    color: #fff;\r\n    padding: 5px;\r\n\r\n    .toolTitle {\r\n      font-size: 20px;\r\n    }\r\n\r\n    .menuBoxMoreBox {\r\n      text-align: center;\r\n      color: #00dad8;\r\n      padding: 0;\r\n      margin: 0;\r\n    }\r\n  }\r\n\r\n  .menuBoxMore:hover {\r\n    color: #fff !important;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .menuBoxContent {\r\n    // width: calc(100% - 190px);\r\n    overflow: auto;\r\n    display: flex;\r\n  }\r\n\r\n  .menuBoxList {\r\n    margin: 0;\r\n    padding: 0;\r\n    color: #BFE2FF;\r\n    text-align: center;\r\n\r\n    .menuListCol {\r\n      display: inline-block;\r\n      background: linear-gradient(146deg,#1c2857,#05091f);\r\n      border: 1px solid hsla(0,0%,100%,.3);\r\n      box-shadow: 3px 4px 5px 0 rgba(5,6,12,.5);\r\n      border-radius: 4px;\r\n      margin: 5px;\r\n      padding: 5px;\r\n      text-align: center;\r\n      cursor: pointer;\r\n\r\n      .toolTitle {\r\n        display: none;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    .fgx {\r\n      color: #fff;\r\n      padding: 0px;\r\n      cursor: default;\r\n    }\r\n\r\n    .sceneSelect {\r\n      margin: 0px;\r\n    }\r\n\r\n    span:hover {\r\n      color: #fff;\r\n      cursor: pointer;\r\n    }\r\n\r\n    .checked {\r\n      color: #fff;\r\n    }\r\n  }\r\n}\r\n</style>\r\n<template>\r\n  <div style=\"z-index: 99;\">\r\n    <div :class=\"themsDefault\">\r\n    <div class=\"menuBoxContainer\">\r\n      <div class=\"menuBoxMore\" @click=\"toolBarClick()\">\r\n        \r\n        <el-tooltip class=\"item\" effect=\"dark\" content=\"收缩/展开\" placement=\"left\">\r\n          <p class=\"menuBoxMoreBox\">\r\n            <span :class=\"['eeIconfont', isShowToolBarIcon]\"></span><br /><span class=\"toolTitle\">{{ isShowToolBarText\r\n            }}</span>\r\n          </p>\r\n        </el-tooltip>\r\n      </div>\r\n      <transition name=\"el-zoom-in-top\">\r\n        <div class=\"menuBoxContent\" v-show=\"isShowToolBar\">\r\n          <p class=\"menuBoxList\">\r\n            <el-tooltip v-for=\"(item, i) in toolBarData\" v-show=\"!item.hide\"  effect=\"dark\" :key=\"i\"\r\n              :content=\"item.title\" placement=\"top\">\r\n              <div class=\"menuListCol\">     \r\n                <img\r\n                 v-if=\"item.icon\"\r\n                 :src=\"getToolbarsImg(item.icon)\"\r\n                 :class=\"[\r\n                  'eeIconfont',\r\n                  item.checked ? 'checked' : '',\r\n                ]\" @click=\"menuClick(item, i)\"\r\n                alt=\"\" />   \r\n                <span\r\n                  v-else\r\n                 :class=\"[\r\n                  'eeIconfont',\r\n                  'iconxuanqumoxing',\r\n                  item.checked ? 'checked' : '',\r\n                ]\" @click=\"menuClick(item, i)\"></span><br />\r\n                <!-- <span :class=\"['toolTitle', item.checked ? 'checked' : '']\">{{\r\n                    item.title\r\n                }}</span> -->\r\n              </div>\r\n            </el-tooltip>\r\n          </p>\r\n        </div>\r\n      </transition>\r\n    </div>\r\n  </div>\r\n  <component v-for=\"item in toolBarData\" :key=\"item.name\" ref=\"customcom\" :is=\"getcomps(item)\" :titem=\"item\" :layerOptions=\"layerOptions\">\r\n    </component>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n//这里没有把每个按钮的功能完全独立处理出来，但是尽可能的简化了代码，功能按钮内部的逻辑写在js/command中，做到了界面逻辑相分离的程度\r\nexport default {\r\n  setup(){\r\n    const getToolbarsImg = (iconUrl)=>{\r\n      return new URL(`/src/assets/img/toolbars/${iconUrl}.png`,import.meta.url).href;\r\n    };\r\n    return {\r\n      getToolbarsImg\r\n    }\r\n  },\r\n  extends: \"\",\r\n  components: {},\r\n  props: {\r\n    itemparams: {\r\n      type: Object,\r\n      default: () => { themsDefault: \"themsVertical\" },\r\n    },\r\n    toolBarData:{\r\n      type:Array,\r\n      default:[]\r\n    }\r\n  },\r\n  computed: {\r\n    themsDefault: {\r\n      get() {\r\n        return this.itemparams && this.itemparams.themsdefault\r\n          ? this.itemparams.themsdefault\r\n          : \"themsHorizontal\";\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    closeAllPanel(name) {\r\n      this.toolBarData.map((val) => {\r\n        val.checked = false;\r\n      });\r\n    },\r\n    menuClick(item, index) {\r\n      let child = this.$refs.customcom.find(\r\n        (i) => i.titem && i.titem.id == item.id\r\n      );\r\n      if (child) {\r\n        if (this.pretool != child && this.pretool && this.pretool.deactive) {\r\n          this.pretool.deactive();\r\n          this.preitem.checked = false;\r\n        }\r\n        if(item.name === 'baseLayers'){\r\n          this.layerOptions.layerTreeData = item.params?.layerTreeData;\r\n        }\r\n        child.onclick(item);\r\n        this.pretool = child;\r\n        this.preitem = item;\r\n      }\r\n    },\r\n    toolBarClick() {\r\n      this.isShowToolBar = !this.isShowToolBar;\r\n      if (this.isShowToolBar) {\r\n        this.isShowToolBarIcon = \"iconshow_zhediezhankai_xiangshang\";\r\n        this.isShowToolBarText = \"展开\";\r\n      } else {\r\n        this.isShowToolBarIcon = \"iconshow_zhediezhankai_xiangxia\";\r\n        this.isShowToolBarText = \"收缩\";\r\n      }\r\n    },\r\n    gettoolbar() {\r\n      return gettoolbar()\r\n    },\r\n    getcomps(item) {\r\n      //require  webpack打包动态加载的办法\r\n      // try {\r\n      //   //所有要动态加载的均需要丢到指定目录中去\r\n      //   var myComponent = require(\"./plugins/\" + item.component).default;\r\n      //   return myComponent;\r\n      // } catch (error) {\r\n      //   console.log(\"组件加载失败:\" + item.name);\r\n      //   return null;\r\n      // }\r\n      try {\r\n        //所有要动态加载的均需要丢到指定目录中去\r\n        if(item.componentDir){\r\n          var myComponent = import.meta.glob(\"../../components/*/*.vue\" ,{eager:true});\r\n          return myComponent[item.component].default;\r\n        }else\r\n        {\r\n          var myComponent = import.meta.glob(\"./plugins/*.vue\" ,{eager:true});\r\n          return myComponent[\"./plugins/\"+item.component].default;\r\n        }\r\n\r\n        \r\n      } catch (error) {\r\n        console.log(\"组件加载失败:\" + item.name);\r\n        return null;\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    //返回当前的toolbar信息，然后进行初始化\r\n    //this.toolBarData = this.gettoolbar();\r\n  },\r\n  created() { },\r\n  data() {\r\n    return {\r\n      isShowToolBar: true,\r\n      isShowToolBarIcon: \"iconshow_zhediezhankai_xiangxia\",\r\n      isShowToolBarText: \"展开\",\r\n      //前一个功能的指引\r\n      pretool: {},\r\n      preitem: {},\r\n      layerOptions:{\r\n         //图层目录树\r\n         layerTreeData: [],\r\n         mapType:\"3D\"\r\n      },\r\n      //toolBarData: [],\r\n      //themsDefault: \"themsVertical\", //themsHorizontal,themsVertical\r\n    };\r\n  },\r\n  watch: {},\r\n};\r\n</script>\r\n\r\n ","D:\\项目\\全景图\\photo\\src\\components\\toolbar\\data.js",[],[],"D:\\项目\\全景图\\photo\\src\\assets\\qindex.js",[],[],"D:\\项目\\全景图\\photo\\src\\utils\\drawutils.js",["67","68","69","70","71","72","73","74","75","76"],[],"import { MarkersPlugin } from \"photo-sphere-viewer/dist/plugins/markers\";\r\nimport { cloneDeep, omit, debounce, isEqual, pickBy, range } from 'lodash';\r\n\r\nlet TEMP_ID_1 = 'marker-temp';\r\nlet id=0;\r\nlet TEMP_ID;\r\n\r\n\r\n/**\r\n * 计算面积\r\n */\r\nexport function caculateArea(panoData,position,center){\r\n    \r\n}\r\n\r\n/**\r\n * 坐标转换，本地坐标转换成84坐标\r\n */\r\nexport function coordinatesLocalTransformWGS84(panoData,position,center){\r\n     //return [center[0],center[1]]\r\n\r\n     let realtiveHeight=center.height;\r\n     let latitude=position.latitude;\r\n     let distance=realtiveHeight/Math.tan(latitude);\r\n     let offsetlatitude=panoData.poseHeading;\r\n     \r\n}\r\n\r\n\r\n/**\r\n * 绘制帮助类，\r\n */\r\nexport class DrawUtil\r\n{\r\n  /**\r\n   * \r\n   * @param {*} viewer  PSV对象\r\n   */\r\n    constructor(viewer){\r\n        this.viewer=viewer.PSV;\r\n        //this.markerForm={};\r\n\r\n        this.markerForm  = {\r\n            saved      : false,\r\n            id         : null,\r\n            type       : null,\r\n            longitude  : null,\r\n            latitude   : null,\r\n            image      : null,\r\n            imageLayer : null,\r\n            html       : null,\r\n            polygonRad : null,\r\n            polylineRad: null,\r\n            width      : null,\r\n            height     : null,\r\n            orientation: null,\r\n            anchor     : null,\r\n            listContent: null,\r\n            content    : null,\r\n            tooltip    : {\r\n              content : null,\r\n              position: null,\r\n            },\r\n            style      : {\r\n              fontSize: null,\r\n              color   : null,\r\n            },\r\n            svgStyle   : {\r\n              fill       : null,\r\n              stroke     : null,\r\n              strokeWidth: null,\r\n            },\r\n          };\r\n\r\n        this.viewer.on('click',  (e, data) => this.onClick(data));\r\n        this.viewer.on('dblclick', (e, data)  => this.onDblClick(data));\r\n\r\n        this.markers = this.viewer.getPlugin(MarkersPlugin);\r\n        this.editMarkers =false;\r\n\r\n        this.PIN_RED_URL = 'https://photo-sphere-viewer-data.netlify.app/assets/pictos/pin-red.png';\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * image，imageLayer，html，polygonRad，polylineRad，开启绘制\r\n     * @param {*} type \r\n     */\r\n    newMarker(type) {\r\n        this.editMarkers=true;\r\n        this.cancelMarker();\r\n        this.markerForm.id = 'marker-' + Math.random().toString(36).slice(2);\r\n        this.markerForm.type = type;\r\n        this.markerForm.orientation = 'front';\r\n        this.markerForm.anchor = 'center center';\r\n        this.markerForm.tooltip.position = 'top center';\r\n\r\n        TEMP_ID=TEMP_ID_1+id++;\r\n\r\n        switch (type) {\r\n          case 'image':\r\n            this.markerForm.image = this.PIN_RED_URL;\r\n            this.markerForm.width = 32;\r\n            this.markerForm.height = 32;\r\n            this.markerForm.anchor = 'bottom center';\r\n            break;\r\n          case 'imageLayer':\r\n            this.markerForm.imageLayer = this.TARGET_URL;\r\n            this.markerForm.width = 120;\r\n            this.markerForm.height = 120;\r\n            break;\r\n          case 'html':\r\n            this.markerForm.html = 'Test content';\r\n            this.markerForm.style.fontSize = '15px';\r\n            this.markerForm.style.color = '#222F3D';\r\n            break;\r\n          case 'polygonRad':\r\n            this.markerForm.polygonRad = [];\r\n            this.markerForm.svgStyle.fill = '#E84B3C';\r\n            this.markerForm.svgStyle.strokeWidth = 2;\r\n            this.markerForm.svgStyle.stroke = '#C0382B';\r\n            break;\r\n          case 'polylineRad':\r\n            this.markerForm.polylineRad = [];\r\n            this.markerForm.svgStyle.strokeWidth = 5;\r\n            this.markerForm.svgStyle.stroke = '#27AF60';\r\n            break;\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    onClick(data) {\r\n        \r\n        if (!this.editMarkers || !this.markerForm.type) {\r\n            return;\r\n          }\r\n  \r\n          const longitude = Math.round(data.longitude * 1000) / 1000;\r\n          const latitude = Math.round(data.latitude * 1000) / 1000;\r\n          Object.assign(this.markerForm, { longitude, latitude });\r\n  \r\n          switch (this.markerForm.type) {\r\n            case 'image':\r\n            case 'imageLayer':\r\n            case 'html':\r\n              if (!this.markerForm.saved) {\r\n                this.markers.addMarker({\r\n                  ...cloneDeep(this.markerForm),\r\n                  longitude,\r\n                  latitude,\r\n                });\r\n                this.cancelMarker();\r\n              }\r\n              else {\r\n                this.markers.updateMarker({\r\n                  id: this.markerForm.id,\r\n                  longitude,\r\n                  latitude,\r\n                });\r\n              }\r\n              break;\r\n  \r\n            case 'polygonRad':\r\n              if (this.markerForm.saved) {\r\n                return;\r\n              }\r\n              this.markerForm.polygonRad.push([longitude, latitude]);\r\n              switch (this.markerForm.polygonRad.length) {\r\n                case 1:\r\n                  this.markers.addMarker({\r\n                    id      : TEMP_ID,\r\n                    hideList: true,\r\n                    longitude,\r\n                    latitude,\r\n                    anchor  : 'center center',\r\n                    circle  : Math.max(1, this.markerForm.svgStyle.strokeWidth / 2),\r\n                    svgStyle: {\r\n                      fill: this.markerForm.svgStyle.strokeWidth ? this.markerForm.svgStyle.stroke : this.markerForm.svgStyle.fill,\r\n                    },\r\n                  });\r\n                  break;\r\n                case 2:\r\n                  this.markers.removeMarker(TEMP_ID, false);\r\n                  this.markers.addMarker({\r\n                    id         : TEMP_ID,\r\n                    hideList   : true,\r\n                    polylineRad: this.markerForm.polygonRad,\r\n                    svgStyle   : {\r\n                      strokeWidth: Math.max(1, this.markerForm.svgStyle.strokeWidth),\r\n                      stroke     : this.markerForm.svgStyle.strokeWidth ? this.markerForm.svgStyle.stroke : this.markerForm.svgStyle.fill,\r\n                    },\r\n                  });\r\n                  break;\r\n                default:\r\n                  this.markers.removeMarker(TEMP_ID, false);\r\n                  this.markers.addMarker({\r\n                    ...cloneDeep(this.markerForm),\r\n                    id      : TEMP_ID,\r\n                    hideList: true,\r\n                  });\r\n                  break;\r\n              }\r\n              break;\r\n  \r\n            case 'polylineRad':\r\n              if (this.markerForm.saved) {\r\n                return;\r\n              }\r\n              this.markerForm.polylineRad.push([longitude, latitude]);\r\n              switch (this.markerForm.polylineRad.length) {\r\n                case 1:\r\n                  this.markers.addMarker({\r\n                    id      : TEMP_ID,\r\n                    hideList: true,\r\n                    longitude,\r\n                    latitude,\r\n                    anchor  : 'center center',\r\n                    circle  : Math.max(1, this.markerForm.svgStyle.strokeWidth / 2),\r\n                    svgStyle: {\r\n                      fill: this.markerForm.svgStyle.stroke,\r\n                    },\r\n                  });\r\n                  break;\r\n                default:\r\n                  this.markers.removeMarker(TEMP_ID, false);\r\n                  this.markers.addMarker({\r\n                    ...cloneDeep(this.markerForm),\r\n                    id      : TEMP_ID,\r\n                    hideList: true,\r\n                  });\r\n                  break;\r\n              }\r\n              break;\r\n          }\r\n    }\r\n\r\n    onDblClick() {\r\n        if (!this.editMarkers || !this.markerForm.type) {\r\n            return;\r\n          }\r\n  \r\n          this.markerForm[this.markerForm.type].pop();\r\n          this.completeMarker();\r\n    }\r\n\r\n\r\n    completeMarker() {\r\n        if (!this.markerForm.saved &&\r\n          (this.markerForm.type === 'polygonRad' || this.markerForm.type === 'polylineRad') &&\r\n          this.markerForm[this.markerForm.type].length >= (this.markerForm.type === 'polygonRad' ? 3 : 2)) {\r\n          this.markers.addMarker(cloneDeep(this.markerForm));\r\n        }\r\n\r\n        this.cancelMarker();\r\n      }\r\n\r\n\r\n      /**\r\n       * 取消绘制\r\n       */\r\n      cancelMarker() {\r\n        \r\n        if (!this.markerForm.saved &&\r\n          (this.markerForm.type === 'polygonRad' || this.markerForm.type === 'polylineRad') &&\r\n          this.markerForm[this.markerForm.type].length > 0) {\r\n          this.markers.removeMarker(TEMP_ID);\r\n        }\r\n\r\n        Object.keys(this.markerForm)\r\n          .forEach(key => {\r\n            if (key === 'tooltip' || key === 'style' || key === 'svgStyle') {\r\n              Object.keys(this.markerForm[key])\r\n                .forEach(key2 => this.markerForm[key][key2] = null);\r\n            }\r\n            else {\r\n              this.markerForm[key] = null;\r\n            }\r\n          });\r\n        this.markerForm.saved = false;\r\n      }\r\n\r\n\r\n\r\n   \r\n\r\n}\r\n\r\n",{"ruleId":"77","severity":2,"message":"78","line":12,"column":10,"nodeType":"79","messageId":"80","endLine":12,"endColumn":27},{"ruleId":"77","severity":2,"message":"81","line":19,"column":8,"nodeType":"79","messageId":"80","endLine":19,"endColumn":13},{"ruleId":"77","severity":2,"message":"82","line":20,"column":8,"nodeType":"79","messageId":"80","endLine":20,"endColumn":13},{"ruleId":"77","severity":2,"message":"83","line":21,"column":8,"nodeType":"79","messageId":"80","endLine":21,"endColumn":13},{"ruleId":"77","severity":2,"message":"84","line":102,"column":14,"nodeType":"79","messageId":"80","endLine":102,"endColumn":20},{"ruleId":"77","severity":2,"message":"85","line":112,"column":8,"nodeType":"79","messageId":"80","endLine":112,"endColumn":11},{"ruleId":"77","severity":2,"message":"86","line":119,"column":13,"nodeType":"79","messageId":"80","endLine":119,"endColumn":21},{"ruleId":"77","severity":2,"message":"87","line":121,"column":9,"nodeType":"79","messageId":"80","endLine":121,"endColumn":18},{"ruleId":"77","severity":2,"message":"88","line":183,"column":13,"nodeType":"79","messageId":"80","endLine":183,"endColumn":22},{"ruleId":"89","severity":2,"message":"90","line":281,"column":16,"nodeType":"91","messageId":"92","endLine":283,"endColumn":10,"suggestions":"93"},{"ruleId":"77","severity":2,"message":"94","line":285,"column":15,"nodeType":"79","messageId":"80","endLine":285,"endColumn":18},{"ruleId":"77","severity":2,"message":"95","line":290,"column":9,"nodeType":"79","messageId":"80","endLine":290,"endColumn":25},{"ruleId":"77","severity":2,"message":"96","line":397,"column":15,"nodeType":"79","messageId":"80","endLine":397,"endColumn":20},{"ruleId":"77","severity":2,"message":"84","line":397,"column":22,"nodeType":"79","messageId":"80","endLine":397,"endColumn":28},{"ruleId":"97","severity":2,"message":"98","line":1,"column":1,"nodeType":null,"messageId":"92"},{"ruleId":"99","severity":2,"message":"100","line":255,"column":24,"nodeType":"79","messageId":"101","endLine":255,"endColumn":36},{"ruleId":"102","severity":2,"message":"103","line":259,"column":15,"nodeType":"104","messageId":"105","endLine":259,"endColumn":17},{"ruleId":"77","severity":2,"message":"106","line":272,"column":19,"nodeType":"79","messageId":"80","endLine":272,"endColumn":23},{"ruleId":"77","severity":2,"message":"107","line":277,"column":21,"nodeType":"79","messageId":"80","endLine":277,"endColumn":26},{"ruleId":"108","severity":2,"message":"109","line":305,"column":14,"nodeType":"79","messageId":"110","endLine":305,"endColumn":24},{"ruleId":"111","severity":2,"message":"112","line":324,"column":15,"nodeType":"79","messageId":"113","endLine":324,"endColumn":26},{"ruleId":"77","severity":2,"message":"114","line":2,"column":21,"nodeType":"79","messageId":"80","endLine":2,"endColumn":25},{"ruleId":"77","severity":2,"message":"115","line":2,"column":27,"nodeType":"79","messageId":"80","endLine":2,"endColumn":35},{"ruleId":"77","severity":2,"message":"116","line":2,"column":37,"nodeType":"79","messageId":"80","endLine":2,"endColumn":44},{"ruleId":"77","severity":2,"message":"117","line":2,"column":46,"nodeType":"79","messageId":"80","endLine":2,"endColumn":52},{"ruleId":"77","severity":2,"message":"118","line":2,"column":54,"nodeType":"79","messageId":"80","endLine":2,"endColumn":59},{"ruleId":"77","severity":2,"message":"119","line":12,"column":30,"nodeType":"79","messageId":"80","endLine":12,"endColumn":38},{"ruleId":"77","severity":2,"message":"120","line":12,"column":39,"nodeType":"79","messageId":"80","endLine":12,"endColumn":47},{"ruleId":"77","severity":2,"message":"121","line":12,"column":48,"nodeType":"79","messageId":"80","endLine":12,"endColumn":54},{"ruleId":"77","severity":2,"message":"122","line":24,"column":10,"nodeType":"79","messageId":"80","endLine":24,"endColumn":18},{"ruleId":"77","severity":2,"message":"123","line":25,"column":10,"nodeType":"79","messageId":"80","endLine":25,"endColumn":24},"no-unused-vars","'VirtualTourPlugin' is defined but never used.","Identifier","unusedVar","'icon1' is defined but never used.","'icon2' is defined but never used.","'icon3' is defined but never used.","'option' is defined but never used.","'url' is defined but never used.","'metadata' is defined but never used.","'imagescfg' is assigned a value but never used.","'isusetile' is assigned a value but never used.","no-empty","Empty block statement.","BlockStatement","unexpected",["124"],"'err' is defined but never used.","'defaultoffsetlng' is assigned a value but never used.","'viwer' is defined but never used.","vue/multi-word-component-names","Component name \"toolbar2\" should always be multi-word.","no-unused-labels","'themsDefault:' is defined but never used.","unused","vue/require-valid-default-prop","Type of the default value for 'toolBarData' prop must be a function.","ArrayExpression","invalidType","'name' is defined but never used.","'index' is defined but never used.","no-undef","'gettoolbar' is not defined.","undef","no-redeclare","'myComponent' is already defined.","redeclared","'omit' is defined but never used.","'debounce' is defined but never used.","'isEqual' is defined but never used.","'pickBy' is defined but never used.","'range' is defined but never used.","'panoData' is defined but never used.","'position' is defined but never used.","'center' is defined but never used.","'distance' is assigned a value but never used.","'offsetlatitude' is assigned a value but never used.",{"messageId":"125","data":"126","fix":"127","desc":"128"},"suggestComment",{"type":"129"},{"range":"130","text":"131"},"Add comment inside empty block statement.","block",[8629,8652]," /* empty */ "]